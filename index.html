<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Galactic Hero</title>
  <style>
    body { margin: 0; overflow: hidden; background-color: #1e1e1e; }
    canvas { display: block; }
    #healthBar {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 200px;
      height: 20px;
      background-color: #555;
      border-radius: 5px;
      overflow: hidden;
    }
    #health {
      height: 100%;
      background-color: #00FF00;
    }
    #story {
      position: absolute;
      top: 50px;
      left: 10px;
      color: #FFFFFF;
      font-size: 20px;
      max-width: 600px;
    }
    #pauseOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 40px;
      background-color: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 10px;
      display: none;
    }
    #touchControls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 10;
    }
    #touchControls button {
      font-size: 24px;
      padding: 20px;
      border-radius: 50%;
      border: none;
      background-color: #333;
      color: white;
      box-shadow: 0 0 10px #000;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="healthBar"><div id="health"></div></div>
  <div id="story">Objective: Explore the galaxy. Collect all keys in 10 levels to restore peace!</div>
  <div id="pauseOverlay">PAUSED</div>
  <div id="touchControls">
    <button id="leftBtn">‚Üê</button>
    <button id="rightBtn">‚Üí</button>
    <button id="jumpBtn">‚Üë</button>
    <button id="shootBtn">üí•</button>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const pauseOverlay = document.getElementById("pauseOverlay");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let level = 0;
    const maxLevels = 10;
    let paused = false;

    const player = {
      x: 100,
      y: canvas.height - 150,
      width: 40,
      height: 40,
      speed: 5,
      dx: 0,
      dy: 0,
      jumping: false,
      jumpPower: 12,
      health: 100,
      projectiles: [],
      powerUp: true,
      keysCollected: 0,
      facing: "right",
      sprite: "üßç"
    };

    let platforms = [];
    let enemies = [];
    let keys = [];
    let shrine = {};
    const backgrounds = ["#1e1e1e", "#2e1e3e", "#1e2e3e", "#3e2e1e", "#3e1e3e", "#1e3e3e", "#3e3e1e", "#2e3e1e", "#2e1e2e", "#1e3e2e"];

    function generateLevel(n) {
      document.body.style.backgroundColor = backgrounds[n % backgrounds.length];

      platforms = [
        { x: 0, y: canvas.height - 50, width: canvas.width, height: 50 },
        { x: 300 + n * 50, y: canvas.height - 150, width: 150, height: 20 },
        { x: 600 + n * 40, y: canvas.height - 250, width: 150, height: 20 },
        { x: 1000 + n * 30, y: canvas.height - 200, width: 200, height: 20 },
      ];

      enemies = Array.from({ length: 2 + n }, (_, i) => ({
        x: 400 + i * 150,
        y: canvas.height - 80 - (i % 3) * 80,
        width: 30,
        height: 30,
        dx: (i % 2 === 0 ? 2 : -2)
      }));

      keys = Array.from({ length: 3 }, (_, i) => ({
        x: 500 + i * 300,
        y: canvas.height - 180 - (i % 2) * 80,
        width: 20,
        height: 20
      }));

      shrine = { x: 1600 + n * 100, y: canvas.height - 100, width: 60, height: 80 };
      player.x = 100;
      player.y = canvas.height - 150;
      player.projectiles = [];
      player.keysCollected = 0;
    }

    function movePlayer() {
      player.x += player.dx;
      player.y += player.dy;

      if (player.y + player.height < canvas.height) {
        player.dy += 0.6;
      } else {
        player.dy = 0;
        player.y = canvas.height - player.height;
        player.jumping = false;
      }

      platforms.forEach(p => {
        if (player.y + player.height <= p.y && player.y + player.height + player.dy >= p.y &&
            player.x + player.width > p.x && player.x < p.x + p.width) {
          player.y = p.y - player.height;
          player.dy = 0;
          player.jumping = false;
        }
      });
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.font = "30px sans-serif";
      ctx.fillText(player.sprite, player.x, player.y + player.height);

      platforms.forEach(p => {
        ctx.fillStyle = "#444";
        ctx.fillRect(p.x, p.y, p.width, p.height);
      });

      enemies.forEach(enemy => {
        ctx.fillStyle = "red";
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
      });

      keys.forEach(k => {
        ctx.fillStyle = "gold";
        ctx.fillRect(k.x, k.y, k.width, k.height);
      });

      ctx.fillStyle = "purple";
      ctx.fillRect(shrine.x, shrine.y, shrine.width, shrine.height);

      player.projectiles.forEach(p => {
        ctx.fillStyle = "magenta";
        ctx.fillRect(p.x, p.y, 10, 5);
      });

      document.getElementById("health").style.width = player.health * 2 + "px";
    }

    function shoot() {
      const laser = {
        x: player.facing === "right" ? player.x + player.width : player.x - 10,
        y: player.y + player.height / 2 - 2,
        dx: player.facing === "right" ? 7 : -7
      };
      player.projectiles.push(laser);
    }

    function updateProjectiles() {
      player.projectiles.forEach((p, i) => {
        p.x += p.dx;
        enemies.forEach((e, j) => {
          if (p.x < e.x + e.width && p.x + 10 > e.x && p.y < e.y + e.height && p.y + 5 > e.y) {
            enemies.splice(j, 1);
            player.projectiles.splice(i, 1);
          }
        });
        if (p.x < 0 || p.x > canvas.width) player.projectiles.splice(i, 1);
      });
    }

    function updateEnemies() {
      enemies.forEach(e => {
        e.x += e.dx;
        if (e.x <= 0 || e.x + e.width >= canvas.width) e.dx *= -1;

        if (
          player.x < e.x + e.width &&
          player.x + player.width > e.x &&
          player.y < e.y + e.height &&
          player.y + player.height > e.y
        ) {
          player.health -= 0.5;
        }
      });
    }

    function checkKeys() {
      keys.forEach((k, i) => {
        if (
          player.x < k.x + k.width &&
          player.x + player.width > k.x &&
          player.y < k.y + k.height &&
          player.y + player.height > k.y
        ) {
          keys.splice(i, 1);
          player.keysCollected++;
          document.getElementById("story").innerText = `Level ${level + 1}: Keys collected: ${player.keysCollected}/3`;
        }
      });

      if (
        player.keysCollected === 3 &&
        player.x < shrine.x + shrine.width &&
        player.x + player.width > shrine.x &&
        player.y < shrine.y + shrine.height &&
        player.y + player.height > shrine.y
      ) {
        if (level < maxLevels - 1) {
          level++;
          generateLevel(level);
          document.getElementById("story").innerText = `Level ${level + 1}: Find all keys!`;
        } else {
          document.getElementById("story").innerText = "You restored peace to the Galaxy! YOU WIN! üßçüöÄüåå";
        }
      }
    }

    function update() {
      if (!paused) {
        movePlayer();
        updateProjectiles();
        updateEnemies();
        checkKeys();
        draw();
      }
      requestAnimationFrame(update);
    }

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowRight") {
        player.dx = player.speed;
        player.facing = "right";
      }
      if (e.key === "ArrowLeft") {
        player.dx = -player.speed;
        player.facing = "left";
      }
      if (e.key === " " || e.key === "ArrowUp") {
        if (!player.jumping) {
          player.dy = -player.jumpPower;
          player.jumping = true;
        }
      }
      if (e.key === "z") shoot();
      if (e.key.toLowerCase() === "p") {
        paused = !paused;
        pauseOverlay.style.display = paused ? "block" : "none";
      }
    });

    document.addEventListener("keyup", e => {
      if (["ArrowRight", "ArrowLeft"].includes(e.key)) player.dx = 0;
    });

    // Touch controls
    document.getElementById("leftBtn").addEventListener("touchstart", () => {
      player.dx = -player.speed;
      player.facing = "left";
    });
    document.getElementById("rightBtn").addEventListener("touchstart", () => {
      player.dx = player.speed;
      player.facing = "right";
    });
    document.getElementById("jumpBtn").addEventListener("touchstart", () => {
      if (!player.jumping) {
        player.dy = -player.jumpPower;
        player.jumping = true;
      }
    });
    document.getElementById("shootBtn").addEventListener("touchstart", () => shoot());

    ["leftBtn", "rightBtn"].forEach(id => {
      document.getElementById(id).addEventListener("touchend", () => {
        player.dx = 0;
      });
    });

    generateLevel(level);
    update();
  </script>
</body>
</html>
